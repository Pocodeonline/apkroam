name: Build Android APK

on:
  push:
    branches: [ main, master ]
  pull_request:
    branches: [ main, master ]

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up JDK 17
      uses: actions/setup-java@v4
      with:
        java-version: '17'
        distribution: 'temurin'
        
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      
    - name: Setup Gradle
      uses: gradle/gradle-build-action@v2
      with:
        gradle-version: 8.5
        
    - name: Build debug APK with Gradle
      run: gradle assembleDebug --no-daemon --stacktrace
      
    - name: Upload APK as artifact
      uses: actions/upload-artifact@v4
      with:
        name: RoamTool-APK
        path: app/build/outputs/apk/debug/app-debug.apk
        
    - name: Create Release
      if: github.ref == 'refs/heads/main' || github.ref == 'refs/heads/master'
      uses: softprops/action-gh-release@v1
      with:
        tag_name: v1.0.${{ github.run_number }}
        name: Roam Tool v1.0.${{ github.run_number }}
        body: |
          🚀 **Roam Tool APK Build - THÀNH CÔNG!**
          
          **Tính năng:**
          - Floating bubble overlay như Zalo chat heads
          - Đọc file WiFi từ thư mục Downloads (format: TênWiFi|Password)
          - Tự động mở WiFi settings của Android
          - UI hoàn toàn tiếng Việt
          
          **Cách cài đặt:**
          1. Tải file APK từ Artifacts ở trên ⬆️
          2. Enable "Cài đặt từ nguồn không xác định" trong Settings
          3. Cài đặt APK vào điện thoại
          4. Cấp quyền "Display over other apps" khi được hỏi
          5. Mở app và bắt đầu sử dụng floating bubble!
        files: app/build/outputs/apk/debug/app-debug.apk
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      continue-on-error: true
